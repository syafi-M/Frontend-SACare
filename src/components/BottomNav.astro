---
// BottomNav.astro
const { pathname } = Astro.url;

// Fungsi pembantu untuk cek apakah path sedang aktif
const isActive = (path: string) =>
    pathname === path || (path !== "/" && pathname.startsWith(path));

const navItems = [
    {
        name: "Home",
        href: "/homepage",
        icon: "i-ph-house-line",
        activeIcon: "i-ph-house-line-duotone",
    },
    {
        name: "Layanan",
        href: "/layanan",
        icon: "i-ph-list-bullets",
        activeIcon: "i-ph-list-bullets-duotone",
    },
    {
        name: "Pesanan",
        href: "/orders/history",
        icon: "i-ph-notepad",
        activeIcon: "i-ph-notepad-duotone",
    },
    {
        name: "Profile",
        href: "/profile",
        icon: "i-ph-user",
        activeIcon: "i-ph-user-duotone",
    },
];
---

<nav
    fixed bottom-0 left-0 right-0 z-40
    bg="white/95"
    backdrop="blur-xl"
    border="t neutral-100/50"
    shadow="2xl"
    transition="all duration-300"
    class="pb-[env(safe-area-inset-bottom)]"
    style="height: calc(76px + env(safe-area-inset-bottom));"
>
    <div flex="~ justify-around items-center" h-full px="2 sm:4" max-w-lg mx-auto>
        {
            navItems.map((item, index) => {
                const active = isActive(item.href);
                return (
                    <>
                        {/* Booking Button di tengah (Antara Layanan & Pesanan) */}
                        {index === 2 && (
                            <a 
                                href="/cart" 
                                data-astro-prefetch="hover"
                                relative flex="~ col items-center justify-center" 
                                class="-translate-y-6 active:scale-90 transition-transform"
                            >
                                <div relative class="group">
                                    <button
                                        relative w-15 h-15 rounded-full overflow-hidden font-bold
                                        flex="~ items-center justify-center"
                                        class="bg-gradient-to-br from-yellow-300 to-yellow-500 hover:from-yellow-400 hover:to-yellow-600"
                                        text="neutral-900"
                                        shadow="xl hover:2xl"
                                        transition="all duration-300"
                                        focus="ring-4 ring-yellow-300/50"
                                        aria-label="Buka Keranjang"
                                    >
                                        <div absolute inset-0 opacity-0 transition-opacity duration-500 
                                             bg="gradient-to-r from-transparent via-white/30 to-transparent"
                                             class="group-hover:opacity-100 group-hover:animate-shimmer" />
                                        
                                        <div i-ph-plus-bold 
                                            relative text-2xl transition-transform duration-500
                                            class="group-hover:rotate-90" 
                                        />
                                    </button>
                                    
                                    <div absolute inset-0 rounded-full blur-xl opacity-0 transition-opacity duration-300 z--10
                                         bg="yellow-400/30"
                                         class="group-hover:opacity-100" />
                                </div>
                                <span m="t-2" text="[8px] neutral-700" font-black uppercase tracking-tighter>Booking</span>
                            </a>
                        )}

                        <a
                            href={item.href}
                            data-astro-prefetch="load" /* Memuat halaman tujuan saat link muncul di layar */
                            relative py-1 px-3 rounded-2xl transition-all duration-300
                            flex="~ col items-center justify-center"
                            class={`group ${active ? 'text-yellow-600' : 'text-neutral-400 hover:text-neutral-600'}`}
                        >
                            {/* Indikator Bubble Aktif */}
                            {active && (
                                <div 
                                    absolute inset-0 bg="yellow-50" rounded-2xl z--10 
                                    class="animate-scale-in-bubble" 
                                />
                            )}

                            <div relative flex="~ items-center justify-center" h-7>
                                <div
                                    class={`text-2xl transition-all duration-300 will-change-transform ${
                                        active ? `${item.activeIcon} scale-110` : `${item.icon} group-hover:scale-105`
                                    }`}
                                />
                                
                                {active && (
                                    <div absolute inset--2 rounded-full blur-lg z--20
                                         bg="yellow-400/10" class="animate-pulse" />
                                )}
                            </div>

                            <span
                                mt-1 font-bold tracking-tight transition-all duration-300
                                class={`text-[10px] ${active ? 'opacity-100' : 'opacity-70'}`}
                            >
                                {item.name}
                            </span>
                        </a>
                    </>
                );
            })
        }
    </div>
</nav>